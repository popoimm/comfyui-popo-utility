# ComfyUI Popo Utility

ğŸš€ **é«˜æ€§èƒ½çš„ComfyUIè‡ªå®šä¹‰èŠ‚ç‚¹å·¥å…·é›†** - ğŸ”§ **æ¨¡å—åŒ–å¯æ‰©å±•æ¶æ„**

ä¸€ä¸ªä¸“ä¸ºComfyUIè®¾è®¡çš„å›¾ç‰‡å¤„ç†å®ç”¨å·¥å…·é›†ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¿«é€Ÿæ‰©å±•å’Œæ·»åŠ æ–°èŠ‚ç‚¹ã€‚

## â­ æ ¸å¿ƒç‰¹æ€§

### ğŸ—ï¸ æ¨¡å—åŒ–æ¶æ„
- ğŸ“¦ **è‡ªåŠ¨èŠ‚ç‚¹å‘ç°** - æ–°èŠ‚ç‚¹è‡ªåŠ¨æ³¨å†Œï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- ğŸ”§ **æ‰©å±•å‹å¥½** - åŸºäºæ¨¡æ¿çš„èŠ‚ç‚¹å¼€å‘ï¼Œ5åˆ†é’Ÿåˆ›å»ºæ–°èŠ‚ç‚¹  
- ğŸ“‚ **åˆ†ç±»ç®¡ç†** - èŠ‚ç‚¹æŒ‰åŠŸèƒ½è‡ªåŠ¨åˆ†ç±»ç»„ç»‡
- ğŸ¯ **æ’ä»¶åŒ–è®¾è®¡** - æ”¯æŒç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²èŠ‚ç‚¹æ¨¡å—

### âš¡ æ€§èƒ½ä¼˜åŒ–
- ğŸš€ **é›¶æ‹·è´è®¾è®¡** - ç›´æ¥ä»å¼ é‡shapeè·å–ä¿¡æ¯ï¼Œé¿å…æ•°æ®è½¬æ¢
- â±ï¸ **å¸¸æ•°æ—¶é—´å¤æ‚åº¦** - å¤„ç†æ—¶é—´ä¸å›¾ç‰‡å¤§å°æ— å…³
- ğŸ§  **å†…å­˜å‹å¥½** - æœ€å°åŒ–å†…å­˜å ç”¨ï¼Œé«˜æ•ˆå¤„ç†å¤§å›¾ç‰‡
- ğŸ›¡ï¸ **ç¨³å®šå¯é ** - å®Œå–„çš„é”™è¯¯å¤„ç†ï¼Œé¿å…èŠ‚ç‚¹å´©æºƒ

## ğŸ“¦ å®‰è£…æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šç›´æ¥å®‰è£…åˆ°ComfyUI

1. å°†æœ¬é¡¹ç›®å…‹éš†åˆ°ComfyUIçš„è‡ªå®šä¹‰èŠ‚ç‚¹ç›®å½•ï¼š
```bash
cd ComfyUI/custom_nodes/
git clone https://github.com/your-username/comfyui-popo-utility.git
```

2. é‡å¯ComfyUIå³å¯ä½¿ç”¨

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…

1. ä¸‹è½½æœ¬é¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶
2. å°†æ–‡ä»¶å¤¹å¤åˆ¶åˆ° `ComfyUI/custom_nodes/` ç›®å½•ä¸‹
3. é‡å¯ComfyUI

## ğŸ¯ èŠ‚ç‚¹è¯´æ˜

### ğŸ–¼ï¸ å›¾ç‰‡é•¿çŸ­è¾¹å°ºå¯¸ (Popo Image Size)

**åŠŸèƒ½**ï¼šè·å–å›¾ç‰‡çš„é•¿è¾¹å’ŒçŸ­è¾¹å°ºå¯¸

**è¾“å…¥**ï¼š
- `image` - å›¾ç‰‡è¾“å…¥ï¼ˆIMAGEç±»å‹ï¼‰

**è¾“å‡º**ï¼š
- `long_side` - é•¿è¾¹å°ºå¯¸ï¼ˆINTç±»å‹ï¼‰
- `short_side` - çŸ­è¾¹å°ºå¯¸ï¼ˆINTç±»å‹ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- éœ€è¦æ ¹æ®å›¾ç‰‡å°ºå¯¸è¿›è¡Œæ¡ä»¶åˆ¤æ–­
- å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹è®¡ç®—
- ç”»é¢æ¯”ä¾‹åˆ†æ

### ğŸ“ å›¾ç‰‡è¯¦ç»†å°ºå¯¸ (Popo Image Dimensions)

**åŠŸèƒ½**ï¼šè·å–å›¾ç‰‡çš„è¯¦ç»†å°ºå¯¸ä¿¡æ¯

**è¾“å…¥**ï¼š
- `image` - å›¾ç‰‡è¾“å…¥ï¼ˆIMAGEç±»å‹ï¼‰

**è¾“å‡º**ï¼š
- `width` - å®½åº¦ï¼ˆINTç±»å‹ï¼‰
- `height` - é«˜åº¦ï¼ˆINTç±»å‹ï¼‰  
- `long_side` - é•¿è¾¹å°ºå¯¸ï¼ˆINTç±»å‹ï¼‰
- `short_side` - çŸ­è¾¹å°ºå¯¸ï¼ˆINTç±»å‹ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- éœ€è¦å®Œæ•´çš„å›¾ç‰‡å°ºå¯¸ä¿¡æ¯
- å›¾ç‰‡å¸ƒå±€è®¡ç®—
- åˆ†è¾¨ç‡åˆ†æ

### ğŸ“ å›¾ç‰‡å®½é«˜æ¯” (Popo Image Aspect Ratio)

**åŠŸèƒ½**ï¼šè®¡ç®—å›¾ç‰‡çš„å®½é«˜æ¯”å¹¶è¯†åˆ«å¸¸è§æ¯”ä¾‹

**è¾“å…¥**ï¼š
- `image` - å›¾ç‰‡è¾“å…¥ï¼ˆIMAGEç±»å‹ï¼‰

**è¾“å‡º**ï¼š
- `aspect_ratio` - å®½é«˜æ¯”æ•°å€¼ï¼ˆFLOATç±»å‹ï¼‰
- `ratio_name` - æ¯”ä¾‹åç§°ï¼ˆSTRINGç±»å‹ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- å›¾ç‰‡æ¯”ä¾‹åˆ†æ
- è‡ªåŠ¨è¯†åˆ«å¸¸è§ç”»é¢æ¯”ä¾‹ï¼ˆ16:9ã€4:3ç­‰ï¼‰
- æ¨ªç«–å±åˆ¤æ–­

### ğŸ§® æ•°å­¦è¡¨è¾¾å¼è®¡ç®— (Popo Math Expression)

**åŠŸèƒ½**ï¼šæ”¯æŒåŠ¨æ€æ•°å­¦è¡¨è¾¾å¼è®¡ç®—ï¼Œå…¼å®¹Pythonæ•°å­¦è¿ç®—

**è¾“å…¥**ï¼š
- `a` - æ•°å€¼å‚æ•°Aï¼ˆFLOATç±»å‹ï¼Œé»˜è®¤å€¼0.0ï¼‰
- `b` - æ•°å€¼å‚æ•°Bï¼ˆFLOATç±»å‹ï¼Œé»˜è®¤å€¼0.0ï¼‰
- `c` - æ•°å€¼å‚æ•°Cï¼ˆFLOATç±»å‹ï¼Œé»˜è®¤å€¼0.0ï¼‰
- `expression` - æ•°å­¦è¡¨è¾¾å¼ï¼ˆSTRINGç±»å‹ï¼Œé»˜è®¤"a + b + c"ï¼‰

**è¾“å‡º**ï¼š
- `result_int` - è®¡ç®—ç»“æœæ•´æ•°å€¼ï¼ˆINTç±»å‹ï¼‰
- `result_float` - è®¡ç®—ç»“æœæµ®ç‚¹å€¼ï¼ˆFLOATç±»å‹ï¼‰

**æ”¯æŒçš„å‡½æ•°å’Œå¸¸æ•°**ï¼š
- **åŸºç¡€è¿ç®—**ï¼š`+`, `-`, `*`, `/`, `//`, `%`, `**`
- **æ•°å­¦å‡½æ•°**ï¼š`sqrt`, `pow`, `abs`, `min`, `max`, `round`
- **å–æ•´å‡½æ•°**ï¼š`ceil`, `floor`, `round`
- **ä¸‰è§’å‡½æ•°**ï¼š`sin`, `cos`, `tan`, `asin`, `acos`, `atan`, `atan2`
- **å¯¹æ•°å‡½æ•°**ï¼š`log`, `log10`, `log2`, `exp`
- **æ•°å­¦å¸¸æ•°**ï¼š`pi`, `e`, `tau`, `inf`, `nan`
- **å…¶ä»–å‡½æ•°**ï¼š`factorial`, `gcd`, `degrees`, `radians`

**è¡¨è¾¾å¼ç¤ºä¾‹**ï¼š
- `a + b + c` - ä¸‰æ•°ç›¸åŠ 
- `sqrt(a*a + b*b)` - è®¡ç®—æ–œè¾¹é•¿åº¦
- `sin(radians(a))` - è§’åº¦çš„æ­£å¼¦å€¼
- `ceil(a / b)` - å‘ä¸Šå–æ•´é™¤æ³•
- `max(a, b) if a > 0 else c` - æ¡ä»¶è¡¨è¾¾å¼
- `pow(2, a) + log10(b)` - å¹‚è¿ç®—ä¸å¯¹æ•°

**å®‰å…¨ç‰¹æ€§**ï¼š
- âœ… æ”¯æŒå®Œæ•´çš„Pythonæ•°å­¦è¡¨è¾¾å¼
- ğŸ›¡ï¸ å®‰å…¨æ²™ç®±æ‰§è¡Œï¼Œé˜²æ­¢æ¶æ„ä»£ç 
- âš¡ é«˜æ€§èƒ½è®¡ç®—ï¼Œæ”¯æŒå¤æ‚åµŒå¥—è¡¨è¾¾å¼
- ğŸ”¢ åŒæ—¶è¾“å‡ºæ•´æ•°å’Œæµ®ç‚¹æ•°ç»“æœ

**ä½¿ç”¨åœºæ™¯**ï¼š
- å›¾ç‰‡å°ºå¯¸çš„åŠ¨æ€è®¡ç®—
- å¤æ‚çš„æ•°å­¦å˜æ¢
- æ¡ä»¶åˆ†æ”¯è®¡ç®—
- è‡ªå®šä¹‰ç®—æ³•å®ç°

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

æœ¬å·¥å…·é›†åœ¨æ€§èƒ½æ–¹é¢åšäº†ä»¥ä¸‹ä¼˜åŒ–ï¼š

1. **ç›´æ¥å¼ é‡æ“ä½œ** - ç›´æ¥ä»PyTorchå¼ é‡çš„å½¢çŠ¶å±æ€§è·å–å°ºå¯¸ï¼Œé¿å…å›¾ç‰‡æ ¼å¼è½¬æ¢
2. **é›¶æ‹·è´è®¾è®¡** - ä¸å¯¹åŸå§‹å›¾ç‰‡æ•°æ®è¿›è¡Œä»»ä½•ä¿®æ”¹æˆ–å¤åˆ¶
3. **å¿«é€Ÿå¤±è´¥æœºåˆ¶** - å®Œå–„çš„é”™è¯¯å¤„ç†ï¼Œé‡åˆ°å¼‚å¸¸æ—¶å¿«é€Ÿè¿”å›é»˜è®¤å€¼
4. **å†…å­˜å‹å¥½** - ä¸å­˜å‚¨é¢å¤–çš„å›¾ç‰‡æ•°æ®ï¼Œå†…å­˜å ç”¨æå°

## ğŸ”§ æ¨¡å—åŒ–æ¶æ„

é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸ºæœªæ¥æ‰©å±•åšå¥½äº†å‡†å¤‡ï¼š

### ğŸ“ é¡¹ç›®ç»“æ„
```
comfyui-popo-utility/
â”œâ”€â”€ __init__.py              # ä¸»å…¥å£ï¼Œè‡ªåŠ¨æ³¨å†Œæ‰€æœ‰èŠ‚ç‚¹
â”œâ”€â”€ nodes/                   # èŠ‚ç‚¹åŒ…ç›®å½•
â”‚   â”œâ”€â”€ __init__.py         # èŠ‚ç‚¹åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ base_node.py        # åŸºç¡€èŠ‚ç‚¹ç±»
â”‚   â”œâ”€â”€ registry.py         # è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿ
â”‚   â”œâ”€â”€ image_utils.py      # å›¾ç‰‡å¤„ç†èŠ‚ç‚¹
â”‚   â””â”€â”€ [your_nodes].py     # æ‚¨çš„è‡ªå®šä¹‰èŠ‚ç‚¹
â”œâ”€â”€ node_template.py         # æ–°èŠ‚ç‚¹å¼€å‘æ¨¡æ¿  
â”œâ”€â”€ DEVELOPMENT_GUIDE.md     # è¯¦ç»†å¼€å‘æŒ‡å—
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜
```

### ğŸ¯ å¿«é€Ÿæ·»åŠ æ–°èŠ‚ç‚¹

åªéœ€è¦ **3æ­¥** å°±èƒ½æ·»åŠ æ–°èŠ‚ç‚¹ï¼š

```bash
# 1. å¤åˆ¶æ¨¡æ¿
cp node_template.py nodes/my_new_nodes.py

# 2. ç¼–è¾‘æ–°æ–‡ä»¶ï¼Œå®ç°ä½ çš„èŠ‚ç‚¹åŠŸèƒ½
# 3. é‡å¯ComfyUIï¼ŒèŠ‚ç‚¹ä¼šè‡ªåŠ¨è¢«æ³¨å†ŒğŸ‰
```

### ğŸ“„ åŸºç¡€ç±»ä½“ç³»

| åŸºç¡€ç±» | ç”¨é€” | åˆ†ç±» |
|--------|------|------|
| `PopoBaseNode` | é€šç”¨èŠ‚ç‚¹åŸºç±» | `popo-utility` |
| `ImageProcessingNode` | å›¾ç‰‡å¤„ç†ç›¸å…³ | `popo-utility/image` |
| `TextProcessingNode` | æ–‡æœ¬å¤„ç†ç›¸å…³ | `popo-utility/text` |
| `MathNode` | æ•°å­¦è®¡ç®—ç›¸å…³ | `popo-utility/math` |
| `UtilityNode` | å®ç”¨å·¥å…·ç›¸å…³ | `popo-utility/utils` |

### ğŸ“ æ–°èŠ‚ç‚¹å¼€å‘ç¤ºä¾‹

```python
# åœ¨ nodes/my_nodes.py ä¸­
from nodes.base_node import UtilityNode

class HelloWorldNode(UtilityNode):
    DESCRIPTION = "ç®€å•çš„Hello WorldèŠ‚ç‚¹"
    
    @classmethod
    def INPUT_TYPES(cls):
        return {
            "required": {
                "name": ("STRING", {"default": "World"}),
            }
        }
    
    @property 
    def RETURN_TYPES(self): return ("STRING",)
    
    @property
    def RETURN_NAMES(self): return ("greeting",)
    
    @property 
    def FUNCTION(self): return "say_hello"
    
    def say_hello(self, name: str):
        return (f"Hello, {name}!",)

# è®°å¾—æ·»åŠ åˆ°NODE_CLASSESåˆ—è¡¨
NODE_CLASSES = [HelloWorldNode]
```

æ›´å¤šè¯¦ç»†å†…å®¹è¯·å‚è€ƒ ğŸ“š [**å¼€å‘æŒ‡å—**](DEVELOPMENT_GUIDE.md)

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€å·¥ä½œæµ

```
[Load Image] â†’ [å›¾ç‰‡é•¿çŸ­è¾¹å°ºå¯¸] â†’ [è¾“å‡ºé•¿è¾¹å’ŒçŸ­è¾¹]
                     â†“
                [å…¶ä»–å¤„ç†èŠ‚ç‚¹]
```

### é«˜çº§å·¥ä½œæµ

```
[Load Image] â†’ [å›¾ç‰‡è¯¦ç»†å°ºå¯¸] â†’ [æ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹]
                     â†“              â†“
                [å®½åº¦/é«˜åº¦]    [é•¿è¾¹/çŸ­è¾¹]
                     â†“              â†“
                [ä¸åŒçš„å¤„ç†åˆ†æ”¯]
```

### æ•°å­¦è®¡ç®—å·¥ä½œæµ

```
[æ•°å€¼è¾“å…¥A] â†’ [æ•°å­¦è¡¨è¾¾å¼è®¡ç®—] â†’ [æ•´æ•°ç»“æœ]
[æ•°å€¼è¾“å…¥B] â†’        â”‚                  â†’ [æµ®ç‚¹ç»“æœ]
[æ•°å€¼è¾“å…¥C] â†’        â”‚
[è¡¨è¾¾å¼è¾“å…¥] â†’       â”‚

ç¤ºä¾‹è¡¨è¾¾å¼:
- "sqrt(a*a + b*b)" - å‹¾è‚¡å®šç†è®¡ç®—
- "ceil(a / b)" - å‘ä¸Šå–æ•´é™¤æ³•
- "sin(radians(a))" - è§’åº¦è½¬å¼§åº¦åæ±‚æ­£å¼¦
```

### ç»¼åˆå·¥ä½œæµ

```
[Load Image] â†’ [å›¾ç‰‡è¯¦ç»†å°ºå¯¸] â†’ [æ•°å­¦è¡¨è¾¾å¼è®¡ç®—]
                     â”‚                    â”‚
                   width,height         â€œa * 0.75â€
                     â”‚                    â”‚
                     â†“                    â†“
                 [å…¶ä»–èŠ‚ç‚¹]         [ç¼©æ”¾æ•°å€¼]
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

- **å…¼å®¹æ€§**ï¼šæ”¯æŒComfyUIæ ‡å‡†çš„å›¾ç‰‡å¼ é‡æ ¼å¼
- **è¾“å…¥æ ¼å¼**ï¼š[batch, height, width, channels] æˆ– [height, width, channels]
- **æ•°æ®ç±»å‹**ï¼šæ”¯æŒPyTorch Tensorã€NumPy Arrayã€PIL Image
- **Pythonç‰ˆæœ¬**ï¼š>=3.8
- **ä¾èµ–é¡¹**ï¼šPyTorch, NumPy, Pillow

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥å¸®åŠ©æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ æ”¯æŒä¸åé¦ˆ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š

- æäº¤ [GitHub Issues](https://github.com/your-username/comfyui-popo-utility/issues)
- å‚ä¸ [GitHub Discussions](https://github.com/your-username/comfyui-popo-utility/discussions)

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼** â­